<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ver Factura | FACT-3000</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
<script src="https://kit.fontawesome.com/a2e0a4c6b6.js" crossorigin="anonymous"></script>
<style>
body { background-color: #f8f9fa; }
.factura-container { background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-top: 30px; }
h2 { text-align: center; margin-bottom: 30px; }
.total { font-size: 1.2rem; font-weight: bold; text-align: right; }
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <a class="navbar-brand font-weight-bold" href="index.html"><i class="fas fa-file-invoice"></i> FACT-3000</a>
    <ul class="navbar-nav ml-auto">
        <li class="nav-item"><a class="nav-link" href="lista_facturas.html"><i class="fas fa-list"></i> Ver Facturas</a></li>
    </ul>
</nav>

<div class="container">
    <div class="factura-container">
        <h2>Detalle de Factura</h2>
        <div id="detalleFactura"></div>

        <div class="mt-4 text-center">
            <a href="lista_facturas.html" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Volver</a>
            <button id="btnEditar" class="btn btn-warning"><i class="fas fa-edit"></i> Editar</button>
        </div>
    </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const id = params.get("id");
const detalleDiv = document.getElementById("detalleFactura");
const btnEditar = document.getElementById("btnEditar");

function mostrarFactura() {
    const facturas = JSON.parse(localStorage.getItem("facturas")) || [];
    const factura = facturas.find(f => f.id == id);

    if (!factura) {
        detalleDiv.innerHTML = `<div class="alert alert-danger">Factura no encontrada.</div>`;
        btnEditar.style.display = "none";
        return;
    }

    // Crear tabla de productos
    let productosHTML = `
        <table class="table table-bordered mt-3">
            <thead class="thead-light">
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
    `;

    factura.productos.forEach(p => {
        productosHTML += `
            <tr>
                <td>${p.nombre}</td>
                <td>${p.cantidad}</td>
                <td>$${p.precio.toFixed(2)}</td>
                <td>$${p.subtotal.toFixed(2)}</td>
            </tr>
        `;
    });

    productosHTML += `
            </tbody>
        </table>
    `;

    detalleDiv.innerHTML = `
        <p><strong>Cliente:</strong> ${factura.clienteNombre}</p>
        <p><strong>Fecha:</strong> ${factura.fecha}</p>
        <p><strong>Estado:</strong> ${factura.estado}</p>
        ${productosHTML}
        <p class="total">Total: $${factura.total.toFixed(2)}</p>
    `;

    btnEditar.addEventListener("click", () => {
        window.location.href = `formulario_factura.html?id=${factura.id}`;
    });
}

document.addEventListener("DOMContentLoaded", mostrarFactura);
</script>

</body>
</html>
